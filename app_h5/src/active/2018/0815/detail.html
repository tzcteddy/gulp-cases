<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta name="description" content="描述" />
    <meta name="Keywords" content="关键字" />
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="yes" name="apple-touch-fullscreen">
    <meta content="telephone=no,email=no" name="format-detection">
    <script src="../../../public/js/zepto.min.js"></script>
    <script type="text/javascript" src="../../../public/js/html2canvas.min.js"></script>
    <title></title>
    <style>
        *{margin: 0;padding: 0;}
        html,body{width: 100%;font-size:100px;}
        canvas{position:relative;}
        .bg-pic{
            width:100%;height:100%;position:absolute;z-index:1;top:0;left;0;
        }
        .main{margin: auto;width: 100%;max-width: 750px;background: #FFF;}
        .content_info{width:100%;height:100%;}
        .content-pic{width:100%;height:100%;position:absolute;top:0;left:0;}
        .content-word{position:absolute;z-index:8;bottom:42%;left:38%;font-size:0.24rem;color:#fff;}
        .list{top:60%;left:38%;font-size:0.18rem;line-height:0.22rem;}
        .obj{position: relative;height:100%;}
    </style>
</head>
<body >
    <div class="main">
        <div class="box">
            <img src="image/bg.png" alt="" class="bg-pic" />
        </div>
        <div  class="content_info">
            <div class="obj">
                
            </div>
            <p class="content-word nickname"></p>
            <p class="content-word list"></p>
        </div>
    </div>
    <canvas width="100%" height="200" id="cv"></canvas>
    
</body>
</html>
<script>
    $(function(){
        function ImageCenter() {
            var $images = $('.content-pic');
            for (var i = 0; i < $images.length; i++) {
                this.imgLoadPosition($images[i])
            }
        }
        ImageCenter.prototype = {
            constructor: ImageCenter,
            imgLoad: function (img, callBack) {
                var tempImag = new Image
                    , e = $(img).attr("src")
                     $(tempImag).attr("src", e),
                    tempImag.onload = function () {
                        callBack(img, tempImag)
                        html2canvas(document.querySelector(".main"),{canvas: canv}).then(function(canvas) {
                            // canvas转化为图片
                            var dataURL = canvas.toDataURL("image/png");
                            var Img=new Image();
                            Img.src=dataURL;
                            Img.style="width:100%;"
                            document.body.removeChild(document.querySelector(".main"));
                            document.body.removeChild(document.querySelector("canvas"));
                             document.body.appendChild(Img);


                        }).then(function(){
                            if(location.href.indexOf("#reloaded")==-1){
                                location.href=location.href+"#reloaded";
                                location.reload();
                            }
                        })
                    }
            },
            imgLoadPosition: function (a) {
                var i = this;
                i.imgLoad(a, function (a, i) {
                    var t = i.width
                        , e = i.height
                        , n = $(a).parent().width()
                        , s = $(a).parent().height()
                        , o = n / s
                        , l = t / e;
                    if (o < l) {
                        var c = s * l
                            , r = (c - n) / 2;
                        $(a).removeAttr("width"),
                            $(a).css({
                                position: "absolute",
                                top: 0,
                                height: s + "px",
                                left: -r + "px",
                                width: "auto"
                            })
                    } else {
                        var c = s * l
                            , r = (c - n) / 2
                            , d = n / l
                            , h = (d - s) / 2;
                        $(a).css({
                            position: "absolute",
                            top: -h + "px",
                            height: "auto",
                            left: 0,
                            width: "100%"
                        })
                    }
                })
            }
        };
        function GetRequest() {
            var theRequest = new Object();
            var url = location.search; //获取url中"?"符后的字串
            if(url.indexOf( "%" )>0){
                url=decodeURI(location.search)
            }
            if (url.indexOf("?") != -1) {
                var str = url.substr(1);
                var strs = str.split("&");
                for(var i = 0; i < strs.length; i ++) {
                    theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
                }
            }
            return theRequest;
        }
        var Request = new Object();
        Request = GetRequest();
        $(".nickname").html(Request.seller_name)
        $(".list").html(Request.company)
        $(".obj").html("<img src='"+localStorage.getItem("imgFile")+"'  id='scream'   class='content-pic' />")
        new ImageCenter()
        var canv = document.querySelector("canvas");
        var image=document.getElementById("scream");
            
    })
</script>